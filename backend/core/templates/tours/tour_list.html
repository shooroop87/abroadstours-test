{% extends 'base/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ page_title }}{% endblock %}
{% block description %}{{ page_description }}{% endblock %}

{% block content %}
<section data-anim="fade" class="hero -type-1 -min-2 is-in-view">
  <div class="hero__bg">
    <img src="{% static 'img/hero/bg.webp' %}" alt="Tours background" loading="lazy">
    <img src="{% static 'img/hero/1/shape.svg' %}" alt="Shape decoration" loading="lazy">
  </div>
  <div class="container">
    <div class="row justify-center">
      <div class="col-xl-12">
        <div class="hero__content">
          <h1 class="hero__title">{% trans "Our Amazing Tours" %}</h1>
          <p class="hero__text">
            {% trans "Discover authentic experiences with small group tours from Milan" %}
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Categories Navigation -->
{% if categories %}
<section class="layout-pt-md">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="tabs -pills-3 js-tabs">
          <div class="tabs__controls row x-gap-10 y-gap-10 justify-center js-tabs-controls">
            <div class="col-auto">
              <a href="{% url 'tours:list' %}" class="tabs__button fw-500 rounded-200 {% if not request.resolver_match.kwargs.slug %}is-tab-el-active{% endif %}">
                {% trans "All Tours" %}
              </a>
            </div>
            {% for category in categories %}
            <div class="col-auto">
              <a href="{% url 'tours:category' category.safe_translation_getter.slug %}" class="tabs__button fw-500 rounded-200">
                {{ category.safe_translation_getter.name }}
              </a>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endif %}

<!-- Tours Grid -->
<section class="layout-pt-md layout-pb-xl">
  <div class="container">
    {% if tours %}
    <div class="row y-gap-30">
      {% for tour in tours %}
      <div class="col-lg-4 col-md-6">
        <a href="{{ tour.get_absolute_url }}" class="tourCard -type-1 py-10 px-10 border-1 rounded-12 bg-white -hover-shadow">
          <div class="tourCard__header">
            <div class="tourCard__image ratio ratio-28:20">
              {% if tour.featured_image %}
                <img src="{{ tour.featured_image.url }}" 
                     alt="{{ tour.safe_translation_getter.title }}" 
                     class="img-ratio rounded-12" 
                     loading="lazy">
              {% else %}
                <img src="{% static 'img/tours/00_bg_general/default-tour.webp' %}" 
                     alt="{{ tour.safe_translation_getter.title }}" 
                     class="img-ratio rounded-12" 
                     loading="lazy">
              {% endif %}
              
              {% if tour.is_featured %}
              <div class="tourCard__badge">Featured</div>
              {% elif tour.category %}
              <div class="tourCard__badge">{{ tour.category.safe_translation_getter.name }}</div>
              {% endif %}
            </div>
          </div>

          <div class="tourCard__content px-10 pt-10">
            <div class="tourCard__location d-flex items-center text-13 text-light-2">
              <i class="icon-pin d-flex text-16 text-light-2 mr-5"></i>
              {{ tour.category.safe_translation_getter.name|default:"Tour" }}
            </div>

            <h3 class="tourCard__title text-16 fw-500 mt-5">
              <span>{{ tour.safe_translation_getter.title }}</span>
            </h3>

            <div class="tourCard__rating d-flex items-center text-13 mt-5">
              <div class="d-flex x-gap-5">
                {% for i in "12345"|make_list %}
                  {% if forloop.counter <= tour.get_rating_stars %}
                    <div><i class="icon-star text-10 text-yellow-2"></i></div>
                  {% else %}
                    <div><i class="icon-star text-10 text-light-2"></i></div>
                  {% endif %}
                {% endfor %}
              </div>
              <span class="text-dark-1 ml-10">{{ tour.rating }} ({{ tour.reviews_count }})</span>
            </div>

            <div class="d-flex justify-between items-center border-1-top text-13 text-dark-1 pt-10 mt-10">
              <div class="d-flex items-center">
                <i class="icon-clock text-16 mr-5"></i>
                {{ tour.get_duration_display }}
              </div>
              <div>{% trans "From" %} <span class="text-16 fw-500">{{ tour.get_price_display }}</span></div>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="row">
      <div class="col-12">
        <div class="text-center py-60">
          <h3>{% trans "No tours found" %}</h3>
          <p class="mt-10">{% trans "Check back soon for new amazing tours and experiences." %}</p>
          {% if user.is_staff %}
          <div class="mt-20">
            <a href="{% url 'admin:tours_tour_add' %}" class="button -sm -dark-1 bg-accent-1 text-white">
              {% trans "Add Your First Tour" %}
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="d-flex justify-center flex-column mt-60">
      <div class="pagination justify-center">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" 
           class="pagination__button button -accent-1 mr-15 -prev">
          <i class="icon-arrow-left text-15"></i>
        </a>
        {% endif %}

        <div class="pagination__count">
          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <a href="#" class="is-active">{{ num }}</a>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <a href="?page={{ num }}">{{ num }}</a>
            {% elif num == 1 %}
              <a href="?page=1">1</a>
              {% if page_obj.number > 5 %}<div>...</div>{% endif %}
            {% elif num == page_obj.paginator.num_pages %}
              {% if page_obj.number < page_obj.paginator.num_pages|add:'-4' %}<div>...</div>{% endif %}
              <a href="?page={{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</a>
            {% endif %}
          {% endfor %}
        </div>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" 
           class="pagination__button button -accent-1 ml-15 -next">
          <i class="icon-arrow-right text-15"></i>
        </a>
        {% endif %}
      </div>

      <div class="text-14 text-center mt-20">
        {% trans "Showing tours" %} {{ page_obj.start_index }}-{{ page_obj.end_index }} {% trans "of" %} {{ page_obj.paginator.count }}
      </div>
    </div>
    {% endif %}

  </div>
</section>
{% endblock %}
