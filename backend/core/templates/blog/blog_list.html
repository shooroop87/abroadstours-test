{% extends 'base/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Travel Blog - Abroads Tours" %}{% endblock %}
{% block description %}{% trans "Discover amazing travel stories and guides from around the world." %}{% endblock %}

{% block content %}
<section data-anim="fade" class="hero -type-1 -min-2 is-in-view">
  <div class="hero__bg">
    <img src="{% static 'img/hero/bg.webp' %}" alt="image" loading="lazy">
    <img src="{% static 'img/hero/1/shape.svg' %}" alt="image" loading="lazy">
  </div>
  <div class="container">
    <div class="row justify-center">
      <div class="col-xl-12">
        <div class="hero__content">
          <h1 class="hero__title">{% trans "Travel Blog" %}</h1>
          <p class="hero__text">
            {% trans "Discover amazing stories, guides and inspiration for your next adventure" %}
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- –û–¢–õ–ê–î–û–ß–ù–ê–Ø –°–ï–ö–¶–ò–Ø - –í–†–ï–ú–ï–ù–ù–ê–Ø -->
{% if debug %}
<section style="background: #ffeb3b; padding: 20px; margin: 20px; border: 3px solid #f57c00;">
  <h3 style="color: #e65100;">üêõ –û–¢–õ–ê–î–ö–ê BLOG LIST:</h3>
  <strong>–í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤:</strong> {{ posts|length }}<br>
  <strong>MEDIA_URL:</strong> {{ MEDIA_URL }}<br>
  <strong>MEDIA_ROOT:</strong> {{ settings.MEDIA_ROOT }}<br>
  <strong>DEBUG:</strong> {{ debug }}<br>
  {% for post in posts|slice:":1" %}
    <br><strong>–ü–µ—Ä–≤—ã–π –ø–æ—Å—Ç:</strong><br>
    - ID: {{ post.id }}<br>
    - Title: {{ post.get_display_title }}<br>
    - Featured Image Field: "{{ post.featured_image }}"<br>
    {% if post.featured_image %}
      - Image URL: {{ post.featured_image.url }}<br>
      - Full URL: {{ request.scheme }}://{{ request.get_host }}{{ post.featured_image.url }}<br>
      - File exists: 
      <script>
        fetch('{{ post.featured_image.url }}')
          .then(response => {
            if (response.ok) {
              console.log('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ: {{ post.featured_image.url }}');
              document.write('<span style="color: green;">‚úÖ –î–û–°–¢–£–ü–ù–û</span>');
            } else {
              console.error('‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ: {{ post.featured_image.url }}');
              document.write('<span style="color: red;">‚ùå –ù–ï–î–û–°–¢–£–ü–ù–û (HTTP ' + response.status + ')</span>');
            }
          })
          .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {{ post.featured_image.url }}', error);
            document.write('<span style="color: red;">‚ùå –û–®–ò–ë–ö–ê –°–ï–¢–ò</span>');
          });
      </script>
    {% else %}
      - No featured image<br>
    {% endif %}
  {% empty %}
    <br><strong>–ü–æ—Å—Ç–æ–≤ –Ω–µ—Ç!</strong><br>
  {% endfor %}
</section>
{% endif %}

<section class="layout-pt-md layout-pb-xl">
  <div class="container">
    <div class="tabs -pills-3 pt-30 js-tabs">
      <div class="tabs__controls row x-gap-10 y-gap-10 justify-center js-tabs-controls">
        
        <div class="col-auto">
          <button class="tabs__button fw-500 rounded-200 js-tabs-button is-tab-el-active" data-tab-target=".-tab-item-1">
            {% trans "All Articles" %}
          </button>
        </div>

      </div>

      <div class="tabs__content pt-30 js-tabs-content">
        
        <div class="tabs__pane -tab-item-1 is-tab-el-active">
          <div class="row y-gap-30">

            {% for post in posts %}
            <div class="col-lg-4 col-md-6">
              <a href="{{ post.get_absolute_url }}" class="blogCard -type-1">
                <div class="blogCard__image ratio ratio-41:30">
                  {% if post.featured_image %}
                    <img src="{{ post.featured_image.url }}" 
                         alt="{{ post.get_display_title }}" 
                         class="img-ratio rounded-12" 
                         loading="lazy"
                         style="border: 2px solid green; object-fit: cover;"
                         onload="console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {{ post.featured_image.url }}'); this.style.border='2px solid green';"
                         onerror="console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {{ post.featured_image.url }}'); this.style.border='2px solid red'; this.src='{% static 'img/blog/default.webp' %}';">
                  {% else %}
                    <img src="{% static 'img/blog/default.webp' %}" 
                         alt="{{ post.get_display_title }}" 
                         class="img-ratio rounded-12" 
                         loading="lazy"
                         style="border: 2px solid orange; object-fit: cover;"
                         onload="console.log('üü° –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {{ post.id }}');">
                  {% endif %}
                  
                  <div class="blogCard__badge">
                    {% if post.category %}
                      {{ post.category.safe_translation_getter.name|default:"Article" }}
                    {% else %}
                      Article
                    {% endif %}
                  </div>
                </div>

                <div class="blogCard__content mt-30">
                  <div class="blogCard__info text-14">
                    <div class="lh-13">{{ post.published_at|date:"F d, Y" }}</div>
                  </div>

                  <h3 class="blogCard__title text-18 fw-500 mt-10">{{ post.get_display_title }}</h3>
                </div>
              </a>
            </div>
{% empty %}
<div class="col-12">
  <div class="text-center py-60">
    <h3>{% trans "No articles found" %}</h3>
    <p class="mt-10">{% trans "Check back soon for new travel stories and guides." %}</p>
    
    <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–ª–∏ namespace –∏–∑ URL -->
    <div class="mt-20">
      <a href="{% url 'tours' %}" class="button -sm -dark-1 bg-accent-1 text-white">
        {% trans "Browse Our Tours" %}
      </a>
    </div>
  </div>
</div>
{% endfor %}

          </div>
        </div>

      </div>
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="d-flex justify-center flex-column mt-60">
      <div class="pagination justify-center">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" 
           class="pagination__button button -accent-1 mr-15 -prev">
          <i class="icon-arrow-left text-15"></i>
        </a>
        {% endif %}

        <div class="pagination__count">
          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <a href="#" class="is-active">{{ num }}</a>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <a href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">{{ num }}</a>
            {% elif num == 1 %}
              <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">1</a>
              {% if page_obj.number > 5 %}<div>...</div>{% endif %}
            {% elif num == page_obj.paginator.num_pages %}
              {% if page_obj.number < page_obj.paginator.num_pages|add:'-4' %}<div>...</div>{% endif %}
              <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">{{ page_obj.paginator.num_pages }}</a>
            {% endif %}
          {% endfor %}
        </div>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" 
           class="pagination__button button -accent-1 ml-15 -next">
          <i class="icon-arrow-right text-15"></i>
        </a>
        {% endif %}
      </div>

      <div class="text-14 text-center mt-20">
        {% trans "Showing results" %} {{ page_obj.start_index }}-{{ page_obj.end_index }} {% trans "of" %} {{ page_obj.paginator.count }}
      </div>
    </div>
    {% endif %}

  </div>
</section>

<script>
// –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ–¥–∏–∞
document.addEventListener('DOMContentLoaded', function() {
    console.log('üêõ DEBUG: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–µ–¥–∏–∞');
    console.log('MEDIA_URL:', '{{ MEDIA_URL }}');
    console.log('STATIC_URL:', '{{ STATIC_URL }}');
    console.log('DEBUG:', {{ debug|yesno:"true,false" }});
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const images = document.querySelectorAll('.blogCard__image img');
    console.log(`üêõ –ù–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: ${images.length}`);
    
    images.forEach((img, index) => {
        console.log(`üêõ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1}: ${img.src}`);
    });
});
</script>
{% endblock %}